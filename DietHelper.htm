<html>
<head>
<title>Diet Helper</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script>

// --------------------
const globalDebug = 0;
// --------------------

const ingredients = { 
		// ------- FORMAT ---- optionValue : displayName, kCal/100g 
		// ------- ORDER ----- EMPTY MUST ALWAYS BE FIRST, others in ALPHABETICAL order

//  Prop_name      Display_Name     kcal		
	empty:        ["",                  0   ], 
	cacao:        ["Cacao",             3.75],
	latte:        ["Latte",            48   ],
	
};


const menu = {};
var i = 0;

var kCalDay = {
	breakfast: 0,
	snackM:    0,
	lunch:     0,
	snack2:    0,
	dinner:    0
}
	

function getValue(name) { return document.getElementById(name).textContent; }

function setValue(name, value) { return document.getElementById(name).textContent = value; }	
	

function setIngredient() {

	let chosenIngr = event.srcElement.value;
	let activeRow  = event.srcElement.parentNode;
	let baseKcal = activeRow.querySelector(".unit_kcal");
	
	baseKcal.textContent = Math.round(ingredients[chosenIngr][1]);
	calculateIngredient();
}

// reads ingredients list, appends all ingredients as options to dropdown menu
function buildList() {
	let select = document.createElement("select");
 
	for (let item in ingredients) {
		let option = document.createElement("option"); 
		option.innerHTML = ingredients[item][0];
		option.setAttribute("value", item);
		select.appendChild(option);
	}

	return select
}

function addRow(meal) {

	let parent = document.getElementById(meal);
	
	let line = document.createElement("div");
		line.setAttribute("class", "ingredient");
	
	let remove = document.createElement("button");
		remove.setAttribute("class", "minus");
		remove.setAttribute("onclick", "deleteRow()");
		remove.textContent = "X";
	
	let select = buildList();
		select.setAttribute("class", "vertCenter");
		select.setAttribute("onchange", "setIngredient()");
	
	let iMass = document.createElement("button");
		iMass.setAttribute("class", "item_mass vertCenter");
		iMass.textContent = 20;
		iMass.setAttribute("onchange", "calculateIngredient()");  //verificare
		//select.setAttribute("onclick", FUNZIONE PROMPT X INPUT");
	
	let uKcal = document.createElement("span");
		uKcal.setAttribute("class", "unit_kcal vertCenter");
		uKcal.textContent = 0;
	
	let iKcal = document.createElement("span");
		iKcal.setAttribute("class", "item_kcal vertCenter");	
		iKcal.textContent = 0;	
	
	parent.appendChild(line);
		line.appendChild(remove);
		line.appendChild(select);
		line.appendChild(iMass);
		line.appendChild(uKcal);
		line.appendChild(iKcal);
}

function deleteRow() {
	let btnMinus = event.srcElement;
	let riga = btnMinus.parentNode;
	riga.parentNode.removeChild(riga);
}


function toggleBlock(id) {
	let block = document.getElementById(id);
	block.classList.toggle("hidden") ;
	event.srcElement.querySelector(".arrow").classList.toggle("up");
}

function calculateIngredient() {
	let caller = event.srcElement;


	let itemMass_id = caller.parentNode.querySelector(".item_mass");
	let unitKcal_id = caller.parentNode.querySelector(".unit_kcal");
	let itemKcal_id = caller.parentNode.querySelector(".item_kcal");
	
	mass = itemMass_id.textContent;
	kcal = unitKcal_id.textContent;
	
	itemKcal_id.textContent = mass * kcal / 100; 
}

window.onload = function(){

	addRow("breakfast_list");
	addRow("breakfast_list");
	addRow("breakfast_list");
};

</script>

<style>

body {
	background-color: #666666;
	margin: 0px;
	padding: 0px;
	font-family: arial;
}

#container {
	box-sizing: border-box;
	width:100%;
	max-width:390px;
	margin: 5px;
	padding: 5px;
	border: 1px solid black;
}

.meal_group {
}

.meal_header {
	font-weight: bold;
	display:flex;
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.meal_name {
	display: inline-block;
	margin-left: 1em;
	margin-right: 1em;
	flex-grow: 1;
}

.arrow {
	width:  1.2em;
	height: 0.7em;
}

.up {
    -ms-transform: rotate(180deg); /* IE 9 */
    -webkit-transform: rotate(180deg); /* Safari */
    transform: rotate(180deg);
}

.meal_kcal {
	display: inline-block;
	margin-left:  0.25em;
	margin-right: 0.25em;
	width: 12%;
	text-align:right;
	padding-left:  2px;
	padding-right: 2px;
	border: 1px solid black;
	border-radius: 1em;
}

.ingredient {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
	height:2em;
	display:flex;
	
}

select {
	flex-grow: 1;
	box-sizing: border-box;
	display: inline-block;
	height: 1.6em;
	margin-top: auto;
	margin-bottom: auto;
	margin-left: 0.5em;
	margin-right: 0.5em;
}

.item_mass, .unit_kcal, .item_kcal {
	box-sizing:border-box;
	display: inline-block;
	width: 3em;
	margin-left: 0.25em;
	margin-right:0.25em;
	text-align:right;
	padding-left:  2px;
	padding-right: 2px;
	border: 1px solid black;
	border-radius: 1em;
	font-size: 16px;
}

.item_mass {
	background-color: #ffffaa;

}

button {
	box-sizing: border-box; 
	border-width:2px;
	border-style: solid;
	border-radius: 50%;
	padding:0px;
	text-align:center;
	-webkit-appearance: none;
	-moz-appearance: none;
	appearance: none;
}
	
.plus {
	border-color: green;
	height: 1.5em;
	width:  1.5em;
	margin-left: 4em;
	background-color: #aaffaa;
}

.minus {
	border-color: red;
	height: 1.5em;
	width:  1.5em;
	margin-top: auto;
	margin-bottom: auto;
	background-color: #ffaaaa;
	color: red;
	font-size: 10px;	
}

.hidden {
	display: none;
}

.vertCenter {
	margin-top: auto;
	margin-bottom:auto;
}

.deleteRowIcon {
	height: 1.5em;
	width: 1.5em;
}

.arrow {
	width:  1.2em;
	height: 0.7em;
}

.up {
    -ms-transform: rotate(180deg); /* IE 9 */
    -webkit-transform: rotate(180deg); /* Safari */
    transform: rotate(180deg);
}

</style>


</head>


<body>


<div id="container">

	<h4>Diet Helper</h4>

	
	<div class="meal_group" id="breakfast_group">
		<div class="meal_header">
			<div class="meal_name" onclick="toggleBlock('breakfast_block')">
				<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" class="arrow up" x="0px" y="0px" viewBox="0 0 960 560" enable-background="new 0 0 960 560" xml:space="preserve">
					<path d="M480,344.181L268.869,131.889c-15.756-15.859-41.3-15.859-57.054,0c-15.754,15.857-15.754,41.57,0,57.431l237.632,238.937   c8.395,8.451,19.562,12.254,30.553,11.698c10.993,0.556,22.159-3.247,30.555-11.698l237.631-238.937   c15.756-15.86,15.756-41.571,0-57.431s-41.299-15.859-57.051,0L480,344.181z"/>
				</svg>
				Colazione
			</div>
			<div class="meal_kcal">400</div>
		</div>

		<div class="meal_block" id="breakfast_block">
			<div id="breakfast_list"></div>
			<button class="plus" onclick="addRow('breakfast_list')">+</button>
		</div>
	</div>
	
	


</div> <!-- container -->

</body>
</html>
